import{d as M}from"./dayjs.min-8j5BWJOd.js";import{a as C}from"./axios-G2rPRu76.js";import{M as $}from"./modal-wmBw_mPt.js";import{w}from"./index-VXn2zGfc.js";import{_ as v,h as d,o as h,c as b,b as o,i as s,m as x,q as f,f as V,y as P,F as y,j as L,k as D,d as _}from"./index-MOUAHhhC.js";import{P as j}from"./PaginationComponent-2D75kpIo.js";const Y={props:{coupon:{type:Object,default(){return{}}}},data(){return{modal:"",tempCoupon:{}}},components:{Warning:w},methods:{openModal(){this.modal.show()},hideModal(){this.modal.hide()}},watch:{order(){this.tempCoupon=this.coupon}},mounted(){this.modal=new $(this.$refs.modalRef)}},U={class:"modal fade",id:"deleteItemModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modalRef"},F={class:"modal-dialog modal-xl",role:"document"},q={class:"modal-content border-0"},T=o("div",{class:"modal-header bg-danger text-white"},[o("h5",{class:"modal-title",id:"exampleModalLabel"}," 您即將刪除 "),o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),O={class:"modal-body"},R=o("h3",null,"確定要刪除此優惠卷嗎?",-1),B=o("h4",{class:"opacity-50"},"刪除後將無法復原，請務必確認!",-1),E={class:"modal-footer"},N=o("button",{type:"button",class:"btn btn-grey66","data-bs-dismiss":"modal"},"取消",-1);function W(t,e,l,m,n,i){const c=d("Warning");return h(),b("div",U,[o("div",F,[o("div",q,[T,o("div",O,[s(c,{style:{width:"150px",height:"150px",color:"#fde4b4"}}),R,B]),o("div",E,[o("button",{type:"button",class:"btn btn-danger","data-bs-dismiss":"modal",onClick:e[0]||(e[0]=r=>t.$emit("delete-coupon",l.coupon))},"確定刪除"),N])])])],512)}const G=v(Y,[["render",W]]),z={props:{coupon:{type:Object,default(){return{}}}},data(){return{modal:"",tempCoupon:{},isPaid:!1}},emits:["update-coupon"],methods:{openModal(){this.modal.show()},hideModal(){this.modal.hide()}},watch:{coupon(){const t=M(this.coupon.due_date*1e3).format("YYYY-MM-DD");this.tempCoupon={...this.coupon,due_date:t}}},mounted(){this.modal=new $(this.$refs.modal)}},A={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},I={class:"modal-dialog modal-xl",role:"document"},S={class:"modal-content border-0"},H=o("div",{class:"modal-header bg-dark text-white"},[o("h5",{class:"modal-title",id:"exampleModalLabel"},[o("span",null,"編輯優惠卷")]),o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),J={class:"modal-body"},K={class:"p-2 p-lg-3 col-md-6"},Q={class:"form-floating mb-4"},X=o("label",{for:"title"},"優惠卷名稱*",-1),Z={class:"form-floating mb-4"},oo=o("label",{for:"code"},"折扣碼*",-1),eo={class:"form-floating mb-4"},to=o("label",{for:"due_date"},"使用期限*",-1),no={class:"form-floating mb-4"},so=o("label",{for:"percent"},"折扣%數*",-1),ao={class:"form-floating mb-4"},lo={class:"form-check"},io=o("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),co={class:"modal-footer"},uo=o("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ro(t,e,l,m,n,i){const c=d("VField"),r=d("ErrorMessage"),g=d("VForm");return h(),b("div",A,[o("div",I,[o("div",S,[H,o("div",J,[s(g,{class:"row mt-5"},{default:x(({errors:p})=>[o("div",K,[o("div",null,[o("div",Q,[s(c,{type:"text",id:"title",placeholder:"請輸入優惠卷名稱",name:"title",class:f(["form-control",{"is-invalid":p.title}]),rules:"required",modelValue:n.tempCoupon.title,"onUpdate:modelValue":e[0]||(e[0]=a=>n.tempCoupon.title=a)},null,8,["class","modelValue"]),s(r,{name:"title",class:"invalid-feedback"}),X]),o("div",Z,[s(c,{type:"text",id:"code",placeholder:"請輸入商品名稱",name:"code",class:f(["form-control",{"is-invalid":p.code}]),rules:"required",modelValue:n.tempCoupon.code,"onUpdate:modelValue":e[1]||(e[1]=a=>n.tempCoupon.code=a)},null,8,["class","modelValue"]),s(r,{name:"code",class:"invalid-feedback"}),oo]),o("div",eo,[s(c,{type:"date",id:"due_date",placeholder:"請輸入單位",name:"due_date",class:f(["form-control",{"is-invalid":p.due_date}]),rules:"required",modelValue:n.tempCoupon.due_date,"onUpdate:modelValue":e[2]||(e[2]=a=>n.tempCoupon.due_date=a)},null,8,["class","modelValue"]),s(r,{name:"due_date",class:"invalid-feedback"}),to]),o("div",no,[s(c,{type:"number",id:"percent",placeholder:"請輸入售價",name:"percent",class:f(["form-control",{"is-invalid":p.percent}]),rules:"required",modelValue:n.tempCoupon.percent,"onUpdate:modelValue":e[3]||(e[3]=a=>n.tempCoupon.percent=a),modelModifiers:{number:!0}},null,8,["class","modelValue"]),s(r,{name:"percent",class:"invalid-feedback"}),so]),o("div",ao,[o("div",lo,[V(o("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>n.tempCoupon.is_enabled=a),id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[P,n.tempCoupon.is_enabled]]),io])])])]),o("div",co,[uo,o("button",{type:"button",class:"btn btn-primary",onClick:e[5]||(e[5]=a=>t.$emit("update-coupon",n.tempCoupon))}," 確定 ")])]),_:1})])])])],512)}const po=v(z,[["render",ro]]),mo={data(){return{coupons:{},tempCoupon:{},currentPage:"",totalPages:"",isLoading:!1}},components:{CouponModal:po,DelCouponModal:G,PaginationComponent:j},computed:{},methods:{formatTime(t){return M(t*1e3).format("YYYY-MM-DD")},async deleteCoupon(t){const{id:e}=t;this.isLoading=!0;try{const l=await C.delete(`https://vue3-course-api.hexschool.io/v2/api/jeremychan/admin/coupon/${e}`);alert(l.data.message),await this.getCoupons()}catch(l){alert(l)}this.isLoading=!1},openModal(t){console.log(t),this.tempCoupon={...t},this.$refs.couponModal.openModal()},openDelOrderModal(t){this.tempCoupon={...t},this.$refs.delCouponModal.openModal()},async getCoupons(t=1){this.isLoading=!0;try{const e=await C.get(`https://vue3-course-api.hexschool.io/v2/api/jeremychan/admin/coupons?page=${t}`);this.coupons=e.data.coupons,this.totalPages=e.data.pagination.total_pages,this.currentPage=e.data.pagination.current_page}catch(e){alert(e)}this.isLoading=!1},async updateCoupon(t){const e=new Date(t.due_date)/1e3,l={...t,due_date:e};this.isLoading=!0;try{await C.put(`https://vue3-course-api.hexschool.io/v2/api/jeremychan/admin/coupon/${t.id}`,{data:l}),this.$refs.couponModal.hideModal(),this.getCoupons(this.currentPage),alert("成功更新優惠卷")}catch(m){alert(m.response.data.message)}this.isLoading=!1}},async mounted(){await this.getCoupons()}},_o={class:"container my-5 text-center"},ho={class:"text-start mb-5 d-flex justify-content-between"},bo=o("h3",null,"優惠卷列表",-1),fo={class:"btn btn-outline-primary"},go={class:"table mt-4 align-middle"},Co=o("thead",null,[o("tr",null,[o("th",null,"優惠卷名稱"),o("th",null,"使用期限"),o("th",null,"折扣%數"),o("th",null,"優惠碼"),o("th",null,"是否啟用"),o("th",null,"編輯")])],-1),vo={scope:"row"},yo=["onClick"],Mo=["onClick"];function $o(t,e,l,m,n,i){const c=d("loadingVue"),r=d("RouterLink"),g=d("PaginationComponent"),p=d("CouponModal"),a=d("DelCouponModal");return h(),b(y,null,[s(c,{active:n.isLoading},null,8,["active"]),o("section",_o,[o("div",ho,[bo,o("button",fo,[s(r,{class:"navbar-brand",to:"/admin/add-coupon"},{default:x(()=>[D(" 新增優惠卷 ")]),_:1})])]),o("table",go,[Co,o("tbody",null,[(h(!0),b(y,null,L(n.coupons,u=>(h(),b("tr",{key:u.id},[o("th",vo,_(u.title),1),o("td",null,_(i.formatTime(u.due_date)),1),o("td",null,_(u.percent),1),o("td",null,_(u.code),1),o("td",null,_(u.is_enabled?"是":"否"),1),o("td",null,[o("button",{onClick:k=>i.openModal(u),type:"button",class:"btn btn-primary"},"編輯",8,yo)]),o("td",null,[o("button",{onClick:k=>i.openDelOrderModal(u),type:"button",class:"btn btn-outline-danger"},"刪除",8,Mo)])]))),128))])]),s(g,{currentPage:n.currentPage,totalPages:n.totalPages,onGoToPage:i.getCoupons},null,8,["currentPage","totalPages","onGoToPage"]),s(p,{ref:"couponModal",coupon:n.tempCoupon,onUpdateCoupon:i.updateCoupon},null,8,["coupon","onUpdateCoupon"]),s(a,{ref:"delCouponModal",coupon:n.tempCoupon,onDeleteCoupon:i.deleteCoupon},null,8,["coupon","onDeleteCoupon"])])],64)}const Do=v(mo,[["render",$o]]);export{Do as default};
