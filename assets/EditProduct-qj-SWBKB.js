import{a as b}from"./axios-G2rPRu76.js";import{_ as S,x,h as p,o as r,c as m,i as s,b as e,m as y,F as U,k as v,q as g,f as w,y as q,e as _,v as j,d as D,j as E,p as B,l as N}from"./index-MOUAHhhC.js";import{d as z,s as R}from"./index-VXn2zGfc.js";const T={data(){return{item:{title:"",content:"",category:"",imagesUrl:[],is_enabled:1,price:"",origin_price:"",unit:"",description:"",imgUrl:""},tempImg1:"",tempImg2:"",errorMsg:"",isLoading:!1}},components:{DeleteFilled:z,ElSelect:R},methods:{uploadImg(){const n=document.querySelector("#upload-image"),o=document.querySelector("#file-input"),h=new FormData(n);if(o.value){this.isLoading=!0;const f=document.cookie.replace(/(?:(?:^|.*;\s*)token\s*=\s*([^;]*).*$)|^.*$/,"$1");b.defaults.headers.common.Authorization=f,b.post("https://vue3-course-api.hexschool.io/v2/api/jeremychan/admin/upload",h).then(t=>{this.tempImg1=t.data.imageUrl,o.value=""}).catch(t=>{x.error(t.data.message)}).finally(()=>{this.isLoading=!1})}else alert("請先選擇欲上傳之圖片。");this.isLoading=!1},async addItem(){if(this.item.imgUrl===""){this.errorMsg="主圖為必填";return}try{this.isLoading=!0;const n=await b.put(`https://vue3-course-api.hexschool.io/v2/api/jeremychan/admin/product/${this.item.id}`,{data:this.item});alert(`${n.data.message}`)}catch(n){x.error(n.data.message)}this.isLoading=!1},addImage1(){this.item.imagesUrl.push(this.tempImg1),this.tempImg1=""},addImage2(){this.item.imagesUrl.push(this.tempImg2),this.tempImg2=""},chooseMainImg(n){this.item.imgUrl=n},deleteImg(n){this.item.imagesUrl.splice(n,1)}},watch:{"item.imgUrl":function(){this.errorMsg=""}},async mounted(){const n=this.$route.params.id;this.isLoading=!0;try{const h=(await b.get("https://vue3-course-api.hexschool.io/v2/api/jeremychan/admin/products")).data.products.find(f=>f.id===n);this.item=h}catch(o){alert(o)}this.isLoading=!1}},l=n=>(B("data-v-6d793fcb"),n=n(),N(),n),A={class:"container my-5"},P={class:"text-start mb-4 d-flex justify-content-between border-bottom pb-3"},G=l(()=>e("h3",null,"編輯商品",-1)),H={class:"btn btn-outline-primary"},J={class:"p-2 p-lg-3 col-md-6"},K={class:"form-floating mb-4"},O=l(()=>e("label",{for:"title"},"商品名稱*",-1)),Q={class:"form-floating mb-4"},W=l(()=>e("label",{for:"unit"},"單位*",-1)),X={class:"form-floating mb-4"},Y=l(()=>e("option",{value:"jacket"},"jacket",-1)),Z=l(()=>e("option",{value:"shirt"},"shirt",-1)),$=l(()=>e("option",{value:"top"},"top",-1)),ee=l(()=>e("option",{value:"top"},"pants",-1)),te=l(()=>e("option",{value:"hat"},"hat",-1)),oe=l(()=>e("label",{for:"category"},"分類*",-1)),ie={class:"form-floating mb-4"},se=l(()=>e("label",{for:"unit"},"價格*",-1)),le={class:"form-floating mb-4"},ne=l(()=>e("label",{for:"price"},"售價*",-1)),ae={class:"form-floating mb-4"},re=l(()=>e("label",{for:"content"},"產品內容*",-1)),me={class:"form-floating mb-4"},de=l(()=>e("label",{for:"description"},"產品描述*",-1)),ce={class:"form-floating mb-4"},ue={class:"form-check"},pe=l(()=>e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1)),ge={class:"p-2 p-lg-3 col-md-6"},_e=l(()=>e("h5",null,"商品圖片",-1)),he={id:"upload-image",class:"mb-2",action:"/api/whatstoday2024/admin/upload",enctype:"multipart/form-data",method:"post"},fe=l(()=>e("label",{for:"formFile",class:"form-label"},"上傳圖片",-1)),be=["src"],ve={class:"form-floating mb-4"},ye={class:"form-group mb-3"},ke=l(()=>e("label",{for:"imgUrl",class:"form-label"},"圖片網址",-1)),Ie=["src"],Ve={class:"mb-3"},xe=l(()=>e("span",null,"主圖*",-1)),Ue={class:"errorMsg"},we={key:0},Me=["src"],Ce={"mb-3":""},Le={key:0,class:"img-box"},Fe=["src"],Se=["onClick"],qe=["onClick"],je=l(()=>e("div",{class:"d-flex gap-2 mt-3 btn-container"},[e("button",{type:"submit",class:"btn btn-primary btn-md mb-4"},"確認")],-1));function De(n,o,h,f,t,a){const M=p("loadingVue"),C=p("RouterLink"),d=p("VField"),c=p("ErrorMessage"),k=p("ElSelect"),I=p("DeleteFilled"),L=p("VForm");return r(),m(U,null,[s(M,{active:t.isLoading},null,8,["active"]),e("div",A,[e("div",P,[G,e("button",H,[s(C,{class:"navbar-brand",to:"/admin/products"},{default:y(()=>[v(" 商品列表 ")]),_:1})])]),s(L,{class:"row mt-5",onSubmit:a.addItem},{default:y(({errors:u})=>[e("div",J,[e("div",null,[e("div",K,[s(d,{type:"text",id:"title",placeholder:"請輸入商品名稱",name:"title",class:g(["form-control",{"is-invalid":u.title}]),rules:"required",modelValue:t.item.title,"onUpdate:modelValue":o[0]||(o[0]=i=>t.item.title=i)},null,8,["class","modelValue"]),s(c,{name:"title",class:"invalid-feedback"}),O]),e("div",Q,[s(d,{type:"text",id:"unit",placeholder:"請輸入單位",name:"unit",class:g(["form-control",{"is-invalid":u.unit}]),rules:"required",modelValue:t.item.unit,"onUpdate:modelValue":o[1]||(o[1]=i=>t.item.unit=i)},null,8,["class","modelValue"]),s(c,{name:"unit",class:"invalid-feedback"}),W]),e("div",X,[s(d,{as:"select",id:"category",placeholder:"請選擇分類",name:"category",class:g(["form-select",{"is-invalid":u.category}]),rules:"required",modelValue:t.item.category,"onUpdate:modelValue":o[2]||(o[2]=i=>t.item.category=i)},{default:y(()=>[Y,Z,$,ee,te]),_:2},1032,["class","modelValue"]),s(c,{name:"category",class:"invalid-feedback"}),oe]),e("div",ie,[s(d,{type:"text",id:"origin_price",placeholder:"請輸入價格",name:"origin_price",class:g(["form-control",{"is-invalid":u.origin_price}]),rules:"required",modelValue:t.item.origin_price,"onUpdate:modelValue":o[3]||(o[3]=i=>t.item.origin_price=i),modelModifiers:{number:!0}},null,8,["class","modelValue"]),s(c,{name:"origin_price",class:"invalid-feedback"}),se]),e("div",le,[s(d,{type:"text",id:"price",placeholder:"請輸入售價",name:"price",class:g(["form-control",{"is-invalid":u.price}]),rules:"required",modelValue:t.item.price,"onUpdate:modelValue":o[4]||(o[4]=i=>t.item.price=i),modelModifiers:{number:!0}},null,8,["class","modelValue"]),s(c,{name:"price",class:"invalid-feedback"}),ne]),e("div",ae,[s(d,{type:"text",id:"content",placeholder:"請輸入產品內容",name:"content",class:g(["form-control",{"is-invalid":u.content}]),rules:"required",modelValue:t.item.content,"onUpdate:modelValue":o[5]||(o[5]=i=>t.item.content=i)},null,8,["class","modelValue"]),s(c,{name:"content",class:"invalid-feedback"}),re]),e("div",me,[s(d,{type:"text",id:"description",placeholder:"請輸入產品描述",name:"description",class:g(["form-control",{"is-invalid":u.description}]),rules:"required",modelValue:t.item.description,"onUpdate:modelValue":o[6]||(o[6]=i=>t.item.description=i)},null,8,["class","modelValue"]),s(c,{name:"description",class:"invalid-feedback"}),de]),e("div",ce,[e("div",ue,[w(e("input",{"onUpdate:modelValue":o[7]||(o[7]=i=>t.item.is_enabled=i),id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[q,t.item.is_enabled]]),pe])])])]),e("div",ge,[e("div",null,[_e,e("form",he,[fe,e("input",{ref:"input-file",class:"form-control",type:"file",id:"file-input",name:"file-to-upload",onChange:o[8]||(o[8]=(...i)=>a.uploadImg&&a.uploadImg(...i))},null,544),t.tempImg1!==""?(r(),m("img",{key:0,class:"img",src:t.tempImg1,alt:"image"},null,8,be)):_("",!0),t.tempImg1!==""?(r(),m("button",{key:1,type:"button",onClick:o[9]||(o[9]=(...i)=>a.addImage1&&a.addImage1(...i)),class:"mt-2 btn btn-outline-primary btn-sm"},"新增此圖片至圖片列表")):_("",!0)])]),e("div",null,[e("div",ve,[e("div",ye,[ke,w(e("input",{id:"imgUrl","onUpdate:modelValue":o[10]||(o[10]=i=>t.tempImg2=i),type:"text",class:"form-control",placeholder:"請輸入圖片連結"},null,512),[[j,t.tempImg2]]),t.tempImg2!==""?(r(),m("img",{key:0,class:"img",src:t.tempImg2,alt:"image"},null,8,Ie)):_("",!0),t.tempImg2!==""?(r(),m("button",{key:1,type:"button",onClick:o[11]||(o[11]=(...i)=>a.addImage2&&a.addImage2(...i)),class:"mt-2 btn btn-outline-primary btn-sm"},"新增此圖片至圖片列表")):_("",!0)])])]),e("div",null,[e("div",Ve,[xe,e("span",Ue,D(t.errorMsg),1),t.item.imgUrl?(r(),m("div",we,[e("img",{class:"img",src:t.item.imgUrl,alt:"image"},null,8,Me)])):_("",!0)]),e("div",Ce,[e("span",null,[v("圖片列表(點選"),s(k,{style:{width:"20px",height:"20px",color:"yellow"}}),v("成為主圖 / "),s(I,{style:{width:"20px",height:"20px",color:"black"}}),v("刪除圖片)")]),t.item.imagesUrl.length?(r(),m("div",Le,[(r(!0),m(U,null,E(t.item.imagesUrl,(i,V)=>(r(),m("div",{key:V,style:{position:"relative"}},[e("img",{class:"img",src:i,alt:"image"},null,8,Fe),e("span",{onClick:F=>a.chooseMainImg(i)},[s(k,{style:{width:"30px",height:"30px",color:"yellow",position:"absolute",top:"1",left:"1",cursor:"pointer"}})],8,Se),e("span",{onClick:F=>a.deleteImg(V)},[s(I,{style:{width:"30px",height:"30px",color:"#d4d4d4",position:"absolute",top:"1",right:"1",cursor:"pointer"}})],8,qe)]))),128))])):_("",!0)])]),je])]),_:1},8,["onSubmit"])])],64)}const ze=S(T,[["render",De],["__scopeId","data-v-6d793fcb"]]);export{ze as default};
