import{d as M}from"./dayjs.min-b-vliZQZ.js";import{M as O}from"./modal-CLS8snV1.js";import{_ as g,o as m,c as h,b as e,d,h as c,i as u,F as y,j as v}from"./index-KgTiI9a3.js";import{a as b}from"./axios-G2rPRu76.js";import{w as P}from"./index-_3WxGp7i.js";import{P as x}from"./PaginationComponent-AAERBtCd.js";const C={props:{order:{type:Object,default(){return{}}}},data(){return{modal:"",tempOrder:{},isPaid:!1}},emits:["update-paid"],methods:{formatTime(t){return M(t*1e3).format("YYYY-MM-DD")},openModal(){this.modal.show()},hideModal(){this.modal.hide()}},watch:{order(){this.tempOrder=this.order}},mounted(){this.modal=new O(this.$refs.modal)}},w={class:"modal fade",id:"orderModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},L={class:"modal-dialog modal-xl",role:"document"},D={class:"modal-content border-0"},k=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},[e("span",null,"訂單細節")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Y={class:"modal-body"},j=e("thead",null,[e("tr",null,[e("th",null,"客戶姓名"),e("th",null,"地址"),e("th",null,"電話"),e("th",null,"Email")])],-1),T=e("thead",null,[e("tr",null,[e("th",null,"購買時間"),e("th",null,"購買款項"),e("th",null,"應付金額"),e("th",null,"是否付款")])],-1),V={class:"modal-footer"},B=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function E(t,o,a,f,l,n){var s,i,p,_;return m(),h("div",w,[e("div",L,[e("div",D,[k,e("div",Y,[j,e("tbody",null,[e("tr",null,[e("td",null,d((s=a.order.user)==null?void 0:s.name),1),e("td",null,d((i=a.order.user)==null?void 0:i.address),1),e("td",null,d((p=a.order.user)==null?void 0:p.tel),1),e("td",null,d((_=a.order.user)==null?void 0:_.email),1)])]),T,e("tbody",null,[e("tr",null,[e("td",null,d(n.formatTime(a.order.create_at)),1),e("td",null,d(a.order.total),1),e("td",null,d(a.order.total),1),e("td",null,d(a.order.is_paid?"是":"否"),1)])])]),e("div",V,[B,e("button",{type:"button",class:"btn btn-primary",onClick:o[0]||(o[0]=r=>t.$emit("update-paid",l.tempOrder))}," 修改付款狀態 ")])])])],512)}const W=g(C,[["render",E]]),F={props:{order:{type:Object,default(){return{}}}},data(){return{modal:"",tempOrder:{}}},components:{Warning:P},methods:{openModal(){this.modal.show()},hideModal(){this.modal.hide()}},watch:{order(){this.tempOrder=this.order}},mounted(){this.modal=new O(this.$refs.modalRef)}},G={class:"modal fade",id:"deleteItemModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modalRef"},N={class:"modal-dialog modal-xl",role:"document"},R={class:"modal-content border-0"},U=e("div",{class:"modal-header bg-danger text-white"},[e("h5",{class:"modal-title",id:"exampleModalLabel"}," 您即將刪除 "),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),A={class:"modal-body"},I=e("h3",null,"確定要刪除此訂單嗎?",-1),S=e("h4",{class:"opacity-50"},"刪除後將無法復原，請務必確認!",-1),q={class:"modal-footer"},z=e("button",{type:"button",class:"btn btn-grey66","data-bs-dismiss":"modal"},"取消",-1);function H(t,o,a,f,l,n){const s=c("Warning");return m(),h("div",G,[e("div",N,[e("div",R,[U,e("div",A,[u(s,{style:{width:"150px",height:"150px",color:"#fde4b4"}}),I,S]),e("div",q,[e("button",{type:"button",class:"btn btn-danger","data-bs-dismiss":"modal",onClick:o[0]||(o[0]=i=>t.$emit("delete-order",a.order))},"確定刪除"),z])])])],512)}const J=g(F,[["render",H]]),K={data(){return{orders:{},tempOrder:{},currentPage:"",totalPages:"",isLoading:!1}},components:{OrderModal:W,DelOrderModal:J,PaginationComponent:x},computed:{},methods:{formatTime(t){return M(t*1e3).format("YYYY-MM-DD")},async deleteOrder(t){const{id:o}=t;this.isLoading=!0;try{const a=await b.delete(`https://vue3-course-api.hexschool.io/v2/api/jeremychan/admin/order/${o}`);alert(a.data.message),await this.getOrders()}catch(a){alert(a)}this.isLoading=!1},openModal(t){this.tempOrder={...t},this.$refs.orderModal.openModal()},openDelOrderModal(t){this.tempOrder={...t},this.$refs.delOrderModal.openModal()},async getOrders(t=1){this.isLoading=!0;try{const o=await b.get(`https://vue3-course-api.hexschool.io/v2/api/jeremychan/admin/orders?page=${t}`);this.orders=o.data.orders,this.totalPages=o.data.pagination.total_pages,this.currentPage=o.data.pagination.current_page}catch(o){alert(o)}this.isLoading=!1},async updatePaid(t){const o={is_paid:!t.is_paid};this.isLoading=!0;try{await b.put(`https://vue3-course-api.hexschool.io/v2/api/jeremychan/admin/order/${t.id}`,{data:o}),this.$refs.orderModal.hideModal(),this.getOrders(this.currentPage)}catch(a){alert(a.response.data.message)}this.isLoading=!1}},async mounted(){await this.getOrders()}},Q={class:"table mt-4"},X=e("thead",null,[e("tr",null,[e("th",null,"購買時間"),e("th",null,"客戶姓名"),e("th",null,"Email"),e("th",null,"購買款項"),e("th",null,"應付金額"),e("th",null,"是否付款"),e("th",null,"編輯")])],-1),Z={scope:"row"},ee=["onClick"],te=["onClick"];function oe(t,o,a,f,l,n){const s=c("loadingVue"),i=c("PaginationComponent"),p=c("OrderModal"),_=c("DelOrderModal");return m(),h(y,null,[u(s,{active:l.isLoading},null,8,["active"]),e("table",Q,[X,e("tbody",null,[(m(!0),h(y,null,v(l.orders,r=>(m(),h("tr",{key:r.id},[e("th",Z,d(n.formatTime(r.create_at)),1),e("td",null,d(r.user.name),1),e("td",null,d(r.user.email),1),e("td",null,d(r.total),1),e("td",null,d(r.total),1),e("td",null,d(r.is_paid?"是":"否"),1),e("td",null,[e("button",{onClick:$=>n.openModal(r),type:"button",class:"btn btn-primary"},"檢視",8,ee)]),e("td",null,[e("button",{onClick:$=>n.openDelOrderModal(r),type:"button",class:"btn btn-outline-danger"},"刪除",8,te)])]))),128))])]),u(i,{currentPage:l.currentPage,totalPages:l.totalPages,onGoToPage:n.getOrders},null,8,["currentPage","totalPages","onGoToPage"]),u(p,{ref:"orderModal",order:l.tempOrder,onUpdatePaid:n.updatePaid},null,8,["order","onUpdatePaid"]),u(_,{ref:"delOrderModal",order:l.tempOrder,onDeleteOrder:n.deleteOrder},null,8,["order","onDeleteOrder"])],64)}const ie=g(K,[["render",oe]]);export{ie as default};
